<!doctype html><html lang=zh><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>[翻译]Hello,wasm Pack Cargo.toml | 谷中仁的博客</title><meta name=Description content="关于 LoveIt 主题"><meta property="og:title" content="[翻译]Hello,wasm Pack Cargo.toml"><meta property="og:description" content="Photo by La Miko from Pexels Cargo.toml cargo.toml是Rust 包管理器 cargo 的清单文件。这个文件包 name、 version 和包的依赖，在 Rust 中，我们一般称之为 crate。 在示例"><meta property="og:type" content="article"><meta property="og:url" content="https://guzhongren.github.io/2019/11/%E7%BF%BB%E8%AF%91hellowasm-pack-cargo.toml/"><meta property="article:published_time" content="2019-11-27T23:23:36+08:00"><meta property="article:modified_time" content="2019-11-27T23:23:36+08:00"><meta property="og:site_name" content="谷中仁的博客"><meta name=twitter:card content="summary"><meta name=twitter:title content="[翻译]Hello,wasm Pack Cargo.toml"><meta name=twitter:description content="Photo by La Miko from Pexels Cargo.toml cargo.toml是Rust 包管理器 cargo 的清单文件。这个文件包 name、 version 和包的依赖，在 Rust 中，我们一般称之为 crate。 在示例"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=canonical href=https://guzhongren.github.io/2019/11/%E7%BF%BB%E8%AF%91hellowasm-pack-cargo.toml/><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=prev href=https://guzhongren.github.io/2019/10/%E5%9C%A8-vscode-%E4%B8%8A%E9%85%8D%E7%BD%AErust%E7%9A%84%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/><link rel=next href=https://guzhongren.github.io/2020/01/config-ssh-to-keychina/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/css/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/css/lib/animate/animate.min.css><meta name=msvalidate.01 content="https://cn.bing.com/?mkt=zh-CN"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"[翻译]Hello,wasm Pack Cargo.toml","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/guzhongren.github.io\/2019\/11\/%E7%BF%BB%E8%AF%91hellowasm-pack-cargo.toml\/"},"image":{"@type":"ImageObject","url":"https:\/\/guzhongren.github.io\/images\/avatar.png","width":800,"height":600},"genre":"posts","keywords":"Web, wams, webAssembly, rust","wordcount":1202,"url":"https:\/\/guzhongren.github.io\/2019\/11\/%E7%BF%BB%E8%AF%91hellowasm-pack-cargo.toml\/","datePublished":"2019-11-27T23:23:36\x2b08:00","dateModified":"2019-11-27T23:23:36\x2b08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"谷中仁","logo":{"@type":"ImageObject","url":"https:\/\/guzhongren.github.io\/images\/avatar.png","width":127,"height":40}},"description":""}</script></head><body><script>if(!window.localStorage||!window.localStorage.getItem('theme')){window.isDark=window.matchMedia('(prefers-color-scheme: dark)').matches;}else{window.isDark=(window.localStorage&&window.localStorage.getItem('theme'))==='dark';}
window.isDark&&document.body.classList.add('dark-theme');</script><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class="header-title animated bounceIn"><a href=/>谷中仁的博客</a></div><div class=menu><a class=menu-item href=/posts/>文章</a><a class=menu-item href=/tags/>标签</a><a class=menu-item href=/categories/>分类</a><a class=menu-item href=/geekmd/>Email Editor</a><a class=menu-item href=/about/>关于</a><a href=javascript:void(0); class=theme-switch title=切换主题>
<i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a></div></div></header><header class=mobile id=header-mobile><div class=header-wrapper><div class=header-container><div class="header-title animated bounceIn"><a href=/>谷中仁的博客</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>文章</a><a class=menu-item href=/tags/>标签</a><a class=menu-item href=/categories/>分类</a><a class=menu-item href=/geekmd/>Email Editor</a><a class=menu-item href=/about/>关于</a><a href=javascript:void(0); class=theme-switch title=切换主题>
<i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a></div></div></header><script>window.desktopHeaderMode="fixed";window.mobileHeaderMode="auto";</script><main class=main><div class=container><article class="page single"><h1 class="single-title animated flipInX">[翻译]Hello,wasm Pack Cargo.toml</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a class=author href=https://guzhongren.github.io rel=author target=_blank><i class="fas fa-user-circle fa-fw"></i>谷中仁</a>
</span>&nbsp;<span class=post-category>收录于&nbsp;
<span><a href=/categories/web><i class="far fa-folder fa-fw"></i>Web</a></span></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i><time datetime=2019-11-27>2019-11-27</time>&nbsp;
<i class="fas fa-pencil-alt fa-fw"></i>约 1202 字&nbsp;
<i class="far fa-clock fa-fw"></i>预计阅读 3 分钟&nbsp;</div></div><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><div class=toc id=toc-static><details><summary><div class=toc-title><span>目录</span>
<span><i class="details icon fas fa-angle-down"></i></span></div></summary><div class=toc-content id=toc-content-static><nav id=TableOfContents><ul><li><a href=#cargotoml>Cargo.toml</a><ul><li><a href=#1crate-type>1.crate-type</a></li><li><a href=#2-wasm-bindgen-依赖>2. wasm-bindgen 依赖</a></li><li><a href=#3-features-和-wee_alloc-console_error_panic_hook-dependencies>3. [features] 和 wee_alloc, console_error_panic_hook dependencies</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></div></details></div><div class=content><p><figure><img src=/svg/loading.min.svg data-sizes=auto data-src="https://images.pexels.com/photos/3681653/pexels-photo-3681653.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260" alt="Photo by La Miko from Pexels" title="Photo by La Miko from Pexels" class=lazyload><figcaption class=image-caption>Photo by La Miko from Pexels</figcaption></figure></p><h2 id=cargotoml>Cargo.toml</h2><p><code>cargo.toml</code>是Rust 包管理器 <code>cargo</code> 的清单文件。这个文件包 <code>name</code>、 <code>version</code> 和包的依赖，在 Rust 中，我们一般称之为 <code>crate</code>。</p><p>在示例中给出了一系列信息，但是我们主要讨论如下三点：</p><ul><li><code>crate-type</code></li><li><code>wasm-bindgen</code> 依赖</li><li><code>[features]</code> 和 <code>wee_alloc</code>、<code>console_error_panic_hook</code> 依赖</li></ul><h3 id=1crate-type>1.<code>crate-type</code></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-toml data-lang=toml><span class=p>[</span><span class=nx>lib</span><span class=p>]</span>
<span class=nx>crate</span><span class=err>-</span><span class=nx>type</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;cdylib&#34;</span><span class=p>,</span> <span class=s2>&#34;rlib&#34;</span><span class=p>]</span>
</code></pre></td></tr></table></div></div><p><code>Rust-wasm</code> 包与通常的 <code>crate</code> 有一点不同，作为 WebAssembly 项目， 我们需要在 <code>cargo.toml</code> 中加入该说明。</p><p>如果你熟悉其他的 Rust crate，那么你肯定知道，大多的 crate 的类型是 <code>rlib</code>(默认)， 或者是二进制形式的 <code>bin</code>(这种形式不需要 <code>crate-type</code> 注解), 并且 <code>[lib]</code> 注解在普通的 <code>Cargo</code> 项目中并不需要指定。</p><p>crate-type = [&ldquo;cdylib&rdquo;] 指示你的工程将会被编译为动态系统库 [dynamic system library], 但是对于 WebAssembly，他将会编译为一个没有启动函数的 .wasm 文件，在 Linux 平台上，他将会创建*.so 文件，在macOS 上将会创建*.dylib文件，在 windows 平台上将会创建 *.dylib 文件。</p><p>我们通常指定 <code>crate-type = ["rlib"]</code> 来确保我们的库可以用 wasm-pack 来做单元测试（稍后会看到）。如果没有这个配置，我们将不能测试我们的库，因为 cdylib 包类型和 wasm-pack 的单元测试类型相冲突。</p><p>你可以使用此<a href=https://doc.rust-lang.org/reference/linkage.html target=_blank rel="noopener noreffer">链接</a>
获取更多关于包类型的知识。</p><h3 id=2-wasm-bindgen-依赖>2. wasm-bindgen 依赖</h3><p>wasm-bindgen 在WebAssembly 中是一个重要的依赖。 这个包允许我们使用 <code>[wasm-bindgen]</code> 为在 JavaScript 和 Rust 生成的 wasm 之间的代码打标签。以使我们使用它的属性可以导入 JS 并且导出 Rust。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-toml data-lang=toml><span class=nx>wasm</span><span class=err>-</span><span class=nx>bindgen</span> <span class=p>=</span> <span class=s2>&#34;0.2&#34;</span>
</code></pre></td></tr></table></div></div><p>当我们讨论 lib.rs 生成什么内容的时候，将会看到更多关于怎么使用这个库。
如果你从 JavaScript 技术栈过来，你可能注意到了当我们添加依赖的时候并没有加 <code>^</code> 或者 <code>~</code> ,看起来像是我们只要 <code>0.2</code> 这个版本。然而，事实并非如此！在 Rust 里， <code>^</code> 是默认的，你可使用这个 <a href=https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html target=_blank rel="noopener noreffer">链接</a>
查看更多信息</p><h3 id=3-features-和-wee_alloc-console_error_panic_hook-dependencies>3. [features] 和 wee_alloc, console_error_panic_hook dependencies</h3><p>作为我们设计模板的工作的一部分，该模板可帮助人们发现针对特定用例的有用包，该模板包括两个依赖项，这对于开发Rust-wasm包的人们可能非常有用：console_error_panic_hook 和 wee_alloc。</p><p>因为这些依赖关系主要在 Rust-wasm 包开发工作流程的特定部分中有用，所以我们还设置了一些粘合代码，使我们既可以将它们都包含为依赖关系，又可以选择将它们包含在内。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-toml data-lang=toml><span class=p>[</span><span class=nx>features</span><span class=p>]</span>
<span class=nx>default</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;console_error_panic_hook&#34;</span><span class=p>]</span>

<span class=p>[</span><span class=nx>dependencies</span><span class=p>]</span>
<span class=nx>wasm</span><span class=err>-</span><span class=nx>bindgen</span> <span class=p>=</span> <span class=s2>&#34;0.2&#34;</span>

<span class=c># The `console_error_panic_hook` crate provides better debugging of panics by</span>
<span class=c># logging them with `console.error`. This is great for development, but requires</span>
<span class=c># all the `std::fmt` and `std::panicking` infrastructure, so isn&#39;t great for</span>
<span class=c># code size when deploying.</span>
<span class=nx>console_error_panic_hook</span> <span class=p>=</span> <span class=err>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.1.1&#34;</span><span class=p>,</span> <span class=nx>optional</span> <span class=p>=</span> <span class=kc>true</span> <span class=err>}</span>

<span class=c># `wee_alloc` is a tiny allocator for wasm that is only ~1K in code size</span>
<span class=c># compared to the default allocator&#39;s ~10K. It is slower than the default</span>
<span class=c># allocator, however.</span>
<span class=c>#</span>
<span class=c># Unfortunately, `wee_alloc` requires nightly Rust when targeting wasm for now.</span>
<span class=nx>wee_alloc</span> <span class=p>=</span> <span class=err>{</span> <span class=nx>version</span> <span class=p>=</span> <span class=s2>&#34;0.4.2&#34;</span><span class=p>,</span> <span class=nx>optional</span> <span class=p>=</span> <span class=kc>true</span> <span class=err>}</span>
</code></pre></td></tr></table></div></div><p>在我们的代码中，只有在启用某些 [features] 的情况下，我们才会将代码的某些部分标记为正在运行，特别是 console_error_panic_hook 和 wee_alloc。默认情况下，仅启用 console_error_panic_hook。要禁用或启用任一功能，默认情况下，我们可以在 [features] 下编辑 default 数组。</p><p>要了解有关这些功能的更多信息，我们将在 src/lib.rs 和 src/utils.rs 部分中深入讨论它们。
简要地，它们包括：</p><ul><li>console_error_panic_hook ，用于将奔溃消息记录到开发人员控制台的功能。</li><li>wee_alloc，一个使代码量更小而优化的分配器。</li></ul><h2 id=reference>Reference</h2><p><a href=https://guzhongren.github.io/ target=_blank rel="noopener noreffer">1.https://guzhongren.github.io/</a></p><hr><p><figure><img src=/svg/loading.min.svg data-sizes=auto data-src=https://ftp.bmp.ovh/imgs/2020/02/b7282c60d4d581ad.png alt=谷哥说-微信公众号 title=谷哥说-微信公众号 class=lazyload><figcaption class=image-caption>谷哥说-微信公众号</figcaption></figure></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>本文于 2019-11-27 更新</span></div><div class=post-info-license><span>采用 Creative Commons Attribution 4.0 International license 协议发布</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=https://guzhongren.github.io/2019/11/%E7%BF%BB%E8%AF%91hellowasm-pack-cargo.toml/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://guzhongren.github.io/2019/11/%E7%BF%BB%E8%AF%91hellowasm-pack-cargo.toml/ data-title="[翻译]Hello,wasm Pack Cargo.toml" data-hashtags=Web,wams,webAssembly,rust><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://guzhongren.github.io/2019/11/%E7%BF%BB%E8%AF%91hellowasm-pack-cargo.toml/ data-hashtag=Web><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://guzhongren.github.io/2019/11/%E7%BF%BB%E8%AF%91hellowasm-pack-cargo.toml/ data-title="[翻译]Hello,wasm Pack Cargo.toml"><i class="fab fa-weibo fa-fw"></i></a><a href=javascript:void(0); title="分享到 人人" data-sharer=renren data-url=https://guzhongren.github.io/2019/11/%E7%BF%BB%E8%AF%91hellowasm-pack-cargo.toml/><i class="fab fa-renren fa-fw"></i></a><a href=javascript:void(0); title="分享到 百度" data-sharer=baidu data-url=https://guzhongren.github.io/2019/11/%E7%BF%BB%E8%AF%91hellowasm-pack-cargo.toml/ data-title="[翻译]Hello,wasm Pack Cargo.toml"><i class="loveit it-baidu-fill"></i></a><a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://guzhongren.github.io/2019/11/%E7%BF%BB%E8%AF%91hellowasm-pack-cargo.toml/ data-title="[翻译]Hello,wasm Pack Cargo.toml"><i class="fab fa-evernote fa-fw"></i></a></span></div></div></div><div class=post-info-more><section><span><a href=/tags/web><i class="fas fa-tag fa-fw"></i>Web</a>
</span>&nbsp;<span>
<a href=/tags/wams><i class="fas fa-tag fa-fw"></i>wams</a>
</span>&nbsp;<span>
<a href=/tags/webassembly><i class="fas fa-tag fa-fw"></i>webAssembly</a>
</span>&nbsp;<span>
<a href=/tags/rust><i class="fas fa-tag fa-fw"></i>rust</a>
</span>&nbsp;</section><section><span><a href=javascript:window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=https://guzhongren.github.io/2019/10/%E5%9C%A8-vscode-%E4%B8%8A%E9%85%8D%E7%BD%AErust%E7%9A%84%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/ class=prev rel=prev title="在 VSCode 上配置Rust的调试环境"><i class="fas fa-angle-left fa-fw"></i>在 VSCode 上配置Rust的调试环境</a>
<a href=https://guzhongren.github.io/2020/01/config-ssh-to-keychina/ class=next rel=next title="Config ssh to Keychina">Config ssh to Keychina<i class="fas fa-angle-right fa-fw"></i></a></div></div><div class=comment></div></article></div></main><footer class=footer><div class=copyright><div class=copyright-line>由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreffer">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a></div><div class=copyright-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://guzhongren.github.io target=_blank>谷中仁</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><a href=# class="dynamic-to-top animated faster" id=dynamic-to-top><span>&nbsp;</span>
</a><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$",right:"$",display:false},{left:"$$",right:"$$",display:true},{left:"\\(",right:"\\)",display:false},{left:"\\[",right:"\\]",display:true},]});});</script><link rel=stylesheet href=/css/lib/iconfont/iconfont.min.css><link rel=stylesheet href=/css/lib/katex/katex.min.css><link rel=stylesheet href=/css/lib/katex/copy-tex.min.css><script src=/js/lib/smooth-scroll/smooth-scroll.polyfills.min.js></script><script src=/js/lib/sharer/sharer.min.js></script><script src=/js/lib/lazysizes/lazysizes.min.js></script><script src=/js/lib/katex/katex.min.js></script><script src=/js/lib/katex/auto-render.min.js></script><script src=/js/lib/katex/copy-tex.min.js></script><script src=/js/lib/katex/mhchem.min.js></script><script src=/js/theme.min.js></script></body></html>